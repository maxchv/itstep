Data Manipulation Language (DML)
================================

--------------

Модификация таблицы ALERT
=========================

Добавить столбцы
----------------

.. sourcecode:: sql

    ALTER TABLE <имя_таблицы>
        ADD COLUMN <имя_столбца> <тип_столбца>
        [NOT NULL] [UNIQUE | PRIMARY KEY]
        [REFERENCES <имя_мастер_таблицы>(<имя_столбца>)]
      	,...

.. _ALTER: http://www.w3schools.com/sql/sql_alter.asp

Удалить столбцы
---------------

.. sourcecode:: sql

    ALTER TABLE <имя_таблицы>
        DROP COLUMN (<имя_столбца>,...)


Модификация типа столбцов
-------------------------

.. sourcecode:: sql

    ALTER TABLE <имя_таблицы>
       MODIFY COLUMN <имя_столбца> <тип_столбца>
       [NOT NULL] [UNIQUE | PRIMARY KEY]
       [REFERENCES <имя_мастер_таблицы>(<имя_столбца>)]]
       ,...)

--------------

Пример модификации таблицы
==========================

Исходная таблица students
-------------------------

.. sourcecode:: sql

    -- Создание таблицы students с полями id, name, group. id — первичный ключ.
    mysql> CREATE TABLE students
            (
                id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
                name VARCHAR(255) NOT NULL,
                group VARCHAR(255) NULL DEFAULT NULL
            );

Добавление поля
---------------

.. code-block:: sql

    -- Добавление в таблицу students поля "date birth" после поля ID
    mysql> ALTER TABLE students
                ADD COLUMN `date birth` DATE NULL AFTER id;

Модификация колонки
-------------------

.. code-block:: sql

   mysql> ALTER TABLE students
               MODIFY COLUMN name varchar(50);

Удаление поля таблицы
---------------------

.. code-block:: sql

    mysql> ALTER TABLE students
                DROP COLUMN `group`;

--------------

Команды DML
===========

Команды DML содержит следующие конструкции:

- `INSERT`_ – вставка новых данных
- `UPDATE`_ – обновление данных
- `DELETE`_ – удаление данных
- `SELECT`_ – выборка данных

.. _INSERT: http://www.w3schools.com/sql/sql_insert.asp

.. _UPDATE: http://www.w3schools.com/sql/sql_update.asp

.. _DELETE: http://www.w3schools.com/sql/sql_delete.asp

.. _SELECT: http://www.w3schools.com/sql/sql_select.asp

--------------

Тестовая база данных
====================

Поля таблицы authors
--------------------

.. sourcecode:: sql

    mysql> describe authors

+-------+--------------+------+-----+---------+----------------+
| Field | Type         | Null | Key | Default | Extra          |
+=======+==============+======+=====+=========+================+
| id    | int(11)      | NO   | PRI | NULL    | auto_increment |
+-------+--------------+------+-----+---------+----------------+
| name  | varchar(255) | YES  | UNI | NULL    |                |
+-------+--------------+------+-----+---------+----------------+

Поля таблицы books
------------------

.. sourcecode:: sql

    mysql> describe books

+-------------+--------------+------+-----+---------+----------------+
| Field       | Type         | Null | Key | Default | Extra          |
+=============+==============+======+=====+=========+================+
| id          | int(11)      | NO   | PRI | NULL    | auto_increment |
+-------------+--------------+------+-----+---------+----------------+
| title       | varchar(255) | NO   |     | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+
| author      | int(11)      | NO   | MUL | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+
| year        | int(11)      | NO   |     | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+
| description | varchar(255) | YES  |     | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+


--------------

Оператор INSERT
===============

Синтаксис
---------

.. sourcecode:: sql

    INSERT [INTO] <название_таблицы> [( <поле1> [, <поле2> [,...]] )]
    VALUES ( DEFAULT | <значение1> [, <значение2> [,...]] );


Пример
------

В б/д books присутсвуют две таблицы: authors и books

+-----------------+
| Tables_in_books |
+=================+
| authors         |
+-----------------+
| books           |
+-----------------+


.. sourcecode:: sql

    -- Добавление данных в таблицу authors
    mysql> INSERT INTO authors(name)
                VALUES ('Станислав Лем');

+----+---------------------------+
| id | name                      |
+====+===========================+
|  1 | Станислав Лем             |
+----+---------------------------+

.. sourcecode:: sql

    mysql> INSERT INTO books(title, author, year)
                VALUES ("Молох", 1, 2006);

+----+------------+--------+------+-------------+
| id | title      | author | year | description |
+====+============+========+======+=============+
|  1 | Молох      |      1 | 2006 | NULL        |
+----+------------+--------+------+-------------+

--------------

Оператор UPDATE
===============

Синтаксис
---------

.. sourcecode:: sql

    UPDATE <название_таблицы>
        SET <поле1>=<значение1>, <поле2>=<значение2>,...
        WHERE <некое_поле>=<некое_значение>;

Пример
------

.. sourcecode:: sql

    -- Добавляем запись в таблицу books
    mysql> INSERT INTO books(title, author, year)
                VALUES("Солярис", 1, 1960);

+----+----------------+--------+------+-------------+
| id | title          | author | year | description |
+====+================+========+======+=============+
|  1 | Молох          |      1 | 2006 | NULL        |
+----+----------------+--------+------+-------------+
|  2 | Солярис        |      1 | 1960 | NULL        |
+----+----------------+--------+------+-------------+


.. sourcecode:: sql

    -- Обновляем запись с id=2 в таблице books
    mysql> UPDATE books
                SET year=1961
                WHERE id=2;

+----+----------------+--------+------+-------------+
| id | title          | author | year | description |
+====+================+========+======+=============+
|  1 | Молох          |      1 | 2006 | NULL        |
+----+----------------+--------+------+-------------+
|  2 | Солярис        |      1 | 1961 | NULL        |
+----+----------------+--------+------+-------------+

--------------

Оператор DELETE
===============

Синтаксис
---------

.. sourcecode:: sql

    DELETE FROM <название_таблицы>
        WHERE <некое_поле>=<некое_значение>

Пример
------

Таблица авторов

+----+---------------------------------------------------+
| id | name                                              |
+====+===================================================+
|  1 | Станислав Лем                                     |
+----+---------------------------------------------------+
|  2 | Аркадий и Борис Стругацкие                        |
+----+---------------------------------------------------+
|  3 | Александр Беляев                                  |
+----+---------------------------------------------------+
|  4 | Владимир Ленин                                    |
+----+---------------------------------------------------+

Таблица книг

+----+-----------------------------+--------+------+-------------+
| id | title                       | author | year | description |
+====+=============================+========+======+=============+
|  1 | Молох                       |      1 | 2006 | NULL        |
+----+-----------------------------+--------+------+-------------+
|  2 | Солярис                     |      1 | 1961 | NULL        |
+----+-----------------------------+--------+------+-------------+
|  3 | Пикник на обочине           |      2 | 1972 | NULL        |
+----+-----------------------------+--------+------+-------------+
|  4 | Челове-амфибия              |      3 | 1928 | NULL        |
+----+-----------------------------+--------+------+-------------+
|  5 | Трудно быть богом           |      2 | 1963 | NULL        |
+----+-----------------------------+--------+------+-------------+
|  6 | Полное собрание сочинений   |      4 | 1967 | NULL        |
+----+-----------------------------+--------+------+-------------+


-------------

Удаляем записи из таблиц
========================

Вначале удалим все книги т.к. поле author есть foreighn key

.. sourcecode:: sql

    -- Удаление по ключевому полю id
    mysql> DELETE FROM books
                WHERE id=6;

+----+----------------------------------+--------+------+-------------+
| id | title                            | author | year | description |
+====+==================================+========+======+=============+
|  1 | Молох                            |      1 | 2006 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  2 | Солярис                          |      1 | 1961 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  3 | Пикник на обочине                |      2 | 1972 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  4 | Челове-амфибия                   |      3 | 1928 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  5 | Трудно быть богом                |      2 | 1963 | NULL        |
+----+----------------------------------+--------+------+-------------+

После можно удалять и авторов

.. sourcecode:: sql

    -- Удаление по полю name
    mysql> DELETE FROM authors
                WHERE name='Владимир Ленин';

+----+---------------------------------------------------+
| id | name                                              |
+====+===================================================+
|  1 | Станислав Лем                                     |
+----+---------------------------------------------------+
|  2 | Аркадий и Борис Стругацкие                        |
+----+---------------------------------------------------+
|  3 | Александр Беляев                                  |
+----+---------------------------------------------------+

-------------

DQL. Оператор SELECT
====================

Синтаксис
---------

.. sourcecode:: sql

    SELECT [DISTINCT] <список стобцов>,...
        [FROM <источник>]
        [WHERE <фильтр>]
        [GROUP BY <поле>]
        [HAVING <фильтр>]
        [ORDER BY <поле> [ASC | DESC], ...]


- `DISTINCT`_ – исключает записи, содержащие повторяющиеся данные в выбранных полях

- `WHERE`_ — используется для определения, какие строки должны быть выбраны или включены в GROUP BY

- GROUP BY — используется для объединения строк с общими значениями в элементы меньшего набора строк

- HAVING — используется для определения, какие строки после GROUP BY должны быть выбраны

- ORDER BY — используется для определения, какие столбцы используются для сортировки

.. _`DISTINCT`: https://support.office.com/ru-ru/article/%D0%9F%D1%80%D0%B5%D0%B4%D0%B8%D0%BA%D0%B0%D1%82%D1%8B-ALL-DISTINCT-DISTINCTROW-%D0%B8-TOP-24f2a47d-a803-4c7c-8e81-756fe298ce57

.. _`WHERE`: https://ru.wikipedia.org/w/index.php?title=Select_(SQL)&stable=1#.D0.A1.D1.82.D1.80.D1.83.D0.BA.D1.82.D1.83.D1.80.D0.B0_.D0.BE.D0.BF.D0.B5.D1.80.D0.B0.D1.82.D0.BE.D1.80.D0.B0

-------------

Простая выборка
===============

Пример
------

.. sourcecode:: sql

    -- Выборка всех полей и всех записей из таблицы books.
    mysql> SELECT * FROM books;

+----+--------------------------------------------------+--------+------+-------------+
| id | title                                            | author | year | description |
+====+==================================================+========+======+=============+
|  1 | Молох                                            |      1 | 2006 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+
|  2 | Солярис                                          |      1 | 1961 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+
|  3 | Пикник на обочине                                |      2 | 1972 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+
|  4 | Челове-амфибия                                   |      3 | 1928 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+
|  5 | Трудно быть богом                                |      2 | 1963 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+
|  6 | Полное собрание сочинений                        |      4 | 1967 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+
|  7 | Хроники Амбера                                   |      5 | 1991 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+

.. sourcecode:: sql

    -- Выборка только поля title и year из таблицы books.
    mysql> SELECT title, year FROM books;

+--------------------------------------------------+------+
| title                                            | year |
+==================================================+======+
| Молох                                            | 2006 |
+--------------------------------------------------+------+
| Солярис                                          | 1961 |
+--------------------------------------------------+------+
| Пикник на обочине                                | 1972 |
+--------------------------------------------------+------+
| Челове-амфибия                                   | 1928 |
+--------------------------------------------------+------+
| Трудно быть богом                                | 1963 |
+--------------------------------------------------+------+
| Полное собрание сочинений                        | 1967 |
+--------------------------------------------------+------+
| Хроники Амбера                                   | 1991 |
+--------------------------------------------------+------+

-------------

Операторы в фильтрах WHERE
==========================

=============== =================================
 Оператор	     Описание
=============== =================================
 =	             Равно

 <>	или !=       Не равно

 >	             Больше

 <	             Меньше

 >=	             Больше или равно

 <=	             Меньше или равно

 BETWEEN	     Между (включительно)

 LIKE	         Шаблон поиска

 IN	             Для указания множества занчений

 AND OR NOT      Логические И ИЛИ и НЕ
=============== =================================

.. sourcecode:: sql

    -- Выбрать произведения опубликованные между 1960 и 1990 годами
    mysql> SELECT title, year
                FROM books WHERE year > 1960  AND year < 1990;

+---------------------------+------+
| title                     | year |
+===========================+======+
| Солярис                   | 1961 |
+---------------------------+------+
| Пикник на обочине         | 1972 |
+---------------------------+------+
| Трудно быть богом         | 1963 |
+---------------------------+------+
| Полное собрание сочинений | 1967 |
+---------------------------+------+

.. sourcecode:: sql

    -- Тот же самый результат может быть получен с BETWEEN
    mysql> SELECT title, year
                FROM books WHERE year BETWEEN 1960 AND 1990;

.. http://www.w3schools.com/sql/sql_where.asp

-------------

Оператор LIKE
=============

=========================== ==============================================
Знак подстановки	         Описание
=========================== ==============================================
%       	                 Заменяет нуль и более символов

_	                         Замена для одиночного символа

[список]	                 Задает диапазон символов

[^список] или [!список]	     Подходит только для сиволов НЕ из диапазона
=========================== ==============================================

.. sourcecode:: sql

    mysql> SELECT * FROM books WHERE title LIKE 'П%';

+----+--------------------------------------------------+--------+------+-------------+
| id | title                                            | author | year | description |
+====+==================================================+========+======+=============+
|  3 | Пикник на обочине                                |      2 | 1972 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+
|  6 | Полное собрание сочинений                        |      4 | 1967 | NULL        |
+----+--------------------------------------------------+--------+------+-------------+

.. sourcecode:: sql

    mysql> SELECT * FROM books WHERE title LIKE 'Сол%';

+----+----------------+--------+------+-------------+
| id | title          | author | year | description |
+====+================+========+======+=============+
|  2 | Солярис        |      1 | 1961 | NULL        |
+----+----------------+--------+------+-------------+


.. sourcecode:: sql

    mysql> SELECT * FROM books WHERE title LIKE '_____';

+----+------------+--------+------+-------------+
| id | title      | author | year | description |
+====+============+========+======+=============+
|  1 | Молох      |      1 | 2006 | NULL        |
+----+------------+--------+------+-------------+

-------------

Оператор IN и ORDER BY
======================

.. sourcecode:: sql

    -- выборка по авторам с сортировкой по возрастанию
    mysql> SELECT *
                FROM books
                WHERE author IN (2, 3)
                ORDER BY year;

+----+----------------------------------+--------+------+-------------+
| id | title                            | author | year | description |
+====+==================================+========+======+=============+
|  4 | Челове-амфибия                   |      3 | 1928 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  5 | Трудно быть богом                |      2 | 1963 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  3 | Пикник на обочине                |      2 | 1972 | NULL        |
+----+----------------------------------+--------+------+-------------+


.. sourcecode:: sql

    mysql> SELECT *
                FROM books
                WHERE description IS NULL
                ORDER BY author DESC;

+----+----------------------------------+--------+------+-------------+
| id | title                            | author | year | description |
+====+==================================+========+======+=============+
|  7 | Хроники Амбера                   |      5 | 1991 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  6 | Полное собрание сочинений        |      4 | 1967 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  4 | Челове-амфибия                   |      3 | 1928 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  3 | Пикник на обочине                |      2 | 1972 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  5 | Трудно быть богом                |      2 | 1963 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  1 | Молох                            |      1 | 2006 | NULL        |
+----+----------------------------------+--------+------+-------------+
|  2 | Солярис                          |      1 | 1961 | NULL        |
+----+----------------------------------+--------+------+-------------+

-------------

Оператор AS
===========

    Оператор **AS** позволяет задать псевдонимы таблицам и полям таблиц

.. sourcecode:: sql

    mysql> SELECT b.title AS 'название', b.author AS 'автор'
                FROM books AS b;

+---------------------------+------------+
| название                  | автор      |
+===========================+============+
| Молох                     |          1 |
+---------------------------+------------+
| Солярис                   |          1 |
+---------------------------+------------+
| Пикник на обочине         |          2 |
+---------------------------+------------+
| Челове-амфибия            |          3 |
+---------------------------+------------+
| Трудно быть богом         |          2 |
+---------------------------+------------+
| Полное собрание сочинений |          4 |
+---------------------------+------------+
| Хроники Амбера            |          5 |
+---------------------------+------------+


-------------

Полезные ссылки
===============

- `sqlteaching`_ - уроки по SQL (SQLite)
- `sqlbolt`_ - уроки по SQL
- `codeacademy`_ - изучение SQL


.. _`sqlteaching`: https://www.sqlteaching.com/

.. _`codeacademy`: https://www.codecademy.com/learn/learn-sql

.. _`sqlbolt`:  - https://sqlbolt.com